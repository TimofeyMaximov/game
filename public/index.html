<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8" />
  <title>Морской бой</title>
  <style>
    .block {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #grid {
      display: grid;
      grid-template-columns: repeat(10, 30px);
      gap: 2px;
      margin-bottom: 20px;
    }

    .cell {
      width: 30px;
      height: 30px;
      border: 1px solid black;
      text-align: center;
      line-height: 30px;
    }

    .ship {
      background-color: gray;
    }

    .hit {
      background-color: red;
    }

    .miss {
      background-color: lightblue;
    }
  </style>
</head>

<body>
  <section class="block">
    <h1>Морской бой</h1>
    <div id="status">Ожидание подключения...</div>
    <div id="grid"></div>
  </section>

  <script>
    const ws = new WebSocket(location.origin.replace(/^http/, 'ws'));
    const grid = document.getElementById("grid");
    const status = document.getElementById("status");
    let myTurn = false;

    for (let y = 0; y < 10; y++) {
      for (let x = 0; x < 10; x++) {
        const cell = document.createElement("div");
        cell.classList.add("cell");
        cell.dataset.x = x;
        cell.dataset.y = y;
        cell.addEventListener("click", () => {
          if (!myTurn) return;
          ws.send(JSON.stringify({ type: "fire", x, y }));
          myTurn = false;
        });
        grid.appendChild(cell);
      }
    }

    ws.onmessage = (msg) => {
      const data = JSON.parse(msg.data);
      if (data.type === "start") {
        myTurn = data.yourTurn;
        status.textContent = myTurn ? "Ваш ход" : "Ход соперника";
      } else if (data.type === "fire") {
        const cell = grid.children[data.y * 10 + data.x];
        const hit = Math.random() > 0.5;
        cell.classList.add(hit ? "hit" : "miss");
        ws.send(JSON.stringify({ type: "result", x: data.x, y: data.y, hit }));
        myTurn = true;
        status.textContent = "Ваш ход";
      } else if (data.type === "result") {
        const cell = grid.children[data.y * 10 + data.x];
        cell.classList.add(data.hit ? "hit" : "miss");
        status.textContent = "Ход соперника";
      } else if (data.type === "disconnect") {
        status.textContent = "Соперник отключился";
      } else if (data.type === "wait") {
        status.textContent = "Ожидание второго игрока...";
      }
    };
  </script>
</body>

</html>